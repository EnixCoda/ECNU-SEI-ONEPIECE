<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>*BETA* ECNU SEI Onepiece</title>
  <!--bower:css-->
  <link rel="stylesheet" href="../bower_components/angular-material/angular-material.css"/>
  <!--endbower-->
  <link rel="stylesheet" href="style.css">
  <link href="//fonts.lug.ustc.edu.cn/icon?family=Material+Icons" rel="stylesheet">
  <link href='//fonts.lug.ustc.edu.cn/css?family=Roboto' rel='stylesheet'>
</head>
<body ng-cloak ng-app="app" ng-controller="controller" layout="row" layout-align="center">
<md-content class="md-whiteframe-4dp" flex-gt-xs="60" layout="column" id="bodyToastBounds">
  <div ng-if="loadingIndex" flex layout="row" layout-align="center center" layout-padding>
    <md-progress-circular ng-if="!loadIndexFailed" md-mode="indeterminate" md-diameter="40"></md-progress-circular>
    <div>
      <md-icon ng-if="loadIndexFailed" class="material-icons md-warn">report_problem</md-icon>
    </div>
    <p>{{loadIndexFailed?"读取文件列表失败":"正在读取文件列表"}}</p>
  </div>
  <div ng-if="!loadingIndex" flex layout="column">
    <div class="top-banner md-whiteframe-3dp light-background-color left-offset-10" layout
         layout-align="space-between center" layout-wrap>
      <md-button class="back-btn md-fab md-mini background-blue" ng-click="goBack(1)"
                 ng-class="directoryStack.length>1 ? 'active':'hidden'">
        <md-icon class="material-icons color-white adjust-icon-top-margin-up-3">chevron_left</md-icon>
      </md-button>
      <div>
        <!--<div>{{$mdMedia('xs')?'xs':''}}</div>-->
        <!--<div>{{$mdMedia('sm')?'sm':''}}</div>-->
        <!--<div>{{$mdMedia('md')?'md':''}}</div>-->
        <!--<div>{{$mdMedia('lg')?'lg':''}}</div>-->
        <!--<div>{{$mdMedia('xl')?'xl':''}}</div>-->
        <!--<div>{{$mdMedia('gt-xs')?'gt-xs':''}}</div>-->
        <!--<div>{{$mdMedia('gt-sm')?'gt-sm':''}}</div>-->
        <!--<div>{{$mdMedia('gt-md')?'gt-md':''}}</div>-->
        <!--<div>{{$mdMedia('gt-lg')?'gt-lg':''}}</div>-->
        <!--<div>{{$mdMedia('gt-xl')?'gt-xl':''}}</div>-->
      </div>
      <div layout layout-align="end center">
        <div class="lesson-search" ng-if="!isNanoScreen">
          <input type="text" placeholder="搜索课程名" id="searchLessonKey" ng-model="searchLessonKey"
                 ng-change="searchLesson()" ng-focus="searchLesson()" ng-blur="hideSearchResult()">
          <div class="search-results">
            <div class="search-result" ng-repeat="result in searchResults" ng-click="hideSearchResult(result)">
              {{result.name}}
            </div>
          </div>
          <md-icon class="material-icons color-gray" ng-click="clearSearchKey()">close</md-icon>
        </div>
        <div ng-if="isMobile">
          <md-menu md-position-mode="target-right target">
            <md-button class="md-raised top-right-menu background-white" ng-click="$mdOpenMenu($event)">
              <md-icon class="material-icons adjust-icon-top-margin-up-3 color-grey">more_vert</md-icon>
            </md-button>
            <md-menu-content width="3">
              <md-menu-item ng-repeat="func in topFuncs">
                <md-button ng-click="func.func($event)" layout layout-align="center center">
                  <md-icon class="material-icons color-primary adjust-icon-top-margin-down">{{func.icon}}</md-icon>
                  <div flex></div>
                  <p md-menu-align-target>{{func.tip}}</p>
                </md-button>
              </md-menu-item>
            </md-menu-content>
          </md-menu>
        </div>
        <div layout ng-if="!isMobile">
          <md-button class="md-fab md-mini background-white" ng-class="!$first?'no-margin-left':''" ng-repeat="func in topFuncs" ng-click="func.func($event)">
            <md-icon ng-if="(!user.name&&$index==0)||$index>0" class="material-icons adjust-icon-top-margin-up-3 color-primary">
              {{func.icon}}
            </md-icon>
            <span ng-if="user.name&&$index==0" class="short-user-name color-primary">{{user.name?user.name[0]:""}}</span>
            <md-tooltip md-direction="bottom">
              {{func.tip}}
            </md-tooltip>
          </md-button>
        </div>
      </div>
    </div>
    <div class="protect-overflow">
      <md-list class="no-padding-top">
        <md-subheader class="md-no-sticky lesson-route-header">
          <span class="lesson-route" ng-click="goBack(directoryStack.length - 1)">
            <b>ONEPIECE</b>
          </span>
          <span class="lesson-route" ng-repeat="dir in directoryStack" ng-if="!$first"
                ng-click="goBack(directoryStack.length - $index - 1)">
            > <b>{{dir.name}}</b>
          </span>
        </md-subheader>
        <md-divider></md-divider>
        <md-list-item ng-repeat="content in directoryStack[directoryStack.length - 1].content"
                      ng-click="goTo(content, $event)">
          <div layout layout-align="start center">
            <md-icon class="material-icons" ng-style="getFileColor(content)">
              {{content.isDir?"folder":getFileIcon(content)}}
            </md-icon>
            <div class="left-offset-10 file-name-in-list" ng-class="getContentNameStyle(content)">
              <p>{{content.name}}</p>
            </div>
          </div>
          <div flex></div>
          <div>{{!isNanoScreen&&!content.isDir&&content.score!=0?content.score:""}}</div>
          <md-button ng-if="!content.isDir" class="md-icon-button"
                     ng-click="downloadFile(content)"
                     layout
                     layout-align="center center">
            <md-tooltip md-direction="left">
              {{content.gettingDownloadLink?"正在获取下载链接":formatFileSize(content)}}
            </md-tooltip>
            <div>
              <md-icon ng-show="!content.gettingDownloadLink"
                       class="material-icons adjust-icon-top-margin-up-3 color-primary">file_download
              </md-icon>
            </div>
            <div layout layout-align="center center">
              <md-progress-circular ng-show="content.gettingDownloadLink" class="spinner-primary"
                                    md-mode="indeterminate" md-diameter="20">
              </md-progress-circular>
            </div>
          </md-button>
          <md-menu class="no-padding-top no-padding-bottom" ng-if="!content.isDir && directoryStack.length > 2"
                   md-position-mode="target-right target">
            <md-button class="md-icon-button" ng-click="openNestedMenu($mdOpenMenu, $event)"
                       layout-align="center center">
              <md-icon class="material-icons adjust-icon-top-margin-up-3 color-primary">more_vert</md-icon>
            </md-button>
            <md-menu-content width="3">
              <md-menu-item>
                <md-button ng-click="showEdit(content, $event)">
                <!--<md-button ng-click="showEdit(content, $event)" ng-disabled="user.status != 'ONLINE'">-->
                  <md-icon class="material-icons adjust-icon-top-margin-down color-primary">mode_edit</md-icon>
                  <div flex></div>
                  <p md-menu-align-target>修改文件</p>
                </md-button>
              </md-menu-item>
              <md-menu-item>
                <md-button ng-click="" ng-disabled="true">
                  <md-icon class="material-icons adjust-icon-top-margin-down">add</md-icon>
                  <div flex></div>
                  <p md-menu-align-target>其他功能</p>
                </md-button>
              </md-menu-item>
            </md-menu-content>
          </md-menu>
          <md-menu class="no-padding-top no-padding-bottom" ng-if="content.isDir && directoryStack.length > 1"
                   md-position-mode="target-right target">
            <md-button class="md-icon-button" ng-click="openNestedMenu($mdOpenMenu, $event)"
                       layout-align="center center">
              <md-icon class="material-icons adjust-icon-top-margin-up-3 color-primary">more_vert</md-icon>
            </md-button>
            <md-menu-content width="3">
              <md-menu-item ng-if="content.isLesson">
                <md-button ng-click="showLessonPreview(content, $event)">
                  <md-icon class="material-icons adjust-icon-top-margin-down color-primary">feedback</md-icon>
                  <div flex></div>
                  <p md-menu-align-target>课程评价</p>
                </md-button>
              </md-menu-item>
              <md-menu-item ng-if="content.isLesson">
                <md-button ng-click="downloadLesson(content)" ng-disabled="user.status != 'ONLINE'">
                  <md-icon class="material-icons adjust-icon-top-margin-down color-primary">file_download</md-icon>
                  <div flex></div>
                  <p md-menu-align-target>打包下载</p>
                </md-button>
              </md-menu-item>
              <md-menu-item>
                <md-button ng-click="showEdit(content, $event)">
                <!--<md-button ng-click="showEdit(content, $event)" ng-disabled="user.status != 'ONLINE'">-->
                  <md-icon class="material-icons adjust-icon-top-margin-down color-primary">mode_edit</md-icon>
                  <div flex></div>
                  <p md-menu-align-target>修改文件夹</p>
                </md-button>
              </md-menu-item>
              <md-menu-item>
                <md-button ng-disabled="true">
                  <md-icon class="material-icons adjust-icon-top-margin-down">add</md-icon>
                  <div flex></div>
                  <p md-menu-align-target>其他功能</p>
                </md-button>
              </md-menu-item>
            </md-menu-content>
          </md-menu>
          <md-divider></md-divider>
        </md-list-item>
      </md-list>
    </div>
  </div>
  <div>
    <md-subheader class="light-background-color" ng-class="isNanoScreen?'nano-padding':''">
      <span>想得到我的财宝吗？想要的话可以全部给你，去找吧，伟大航路！我把世界上的一切都放在那里！——
        <del>站长</del>
        Gol·D·Roger
      </span>
    </md-subheader>
  </div>
</md-content>
</body>
<!--bower:js-->
<script src="../bower_components/angular/angular.js"></script>
<script src="../bower_components/angular-animate/angular-animate.js"></script>
<script src="../bower_components/angular-aria/angular-aria.js"></script>
<script src="../bower_components/angular-material/angular-material.js"></script>
<script src="deps/moxie.js"></script>
<script src="deps/plupload.dev.js"></script>
<script src="deps/qiniu.js"></script>
<!--endbower-->
<script src="scripts/app.js"></script>
<script src="scripts/controller.js"></script>
</html>